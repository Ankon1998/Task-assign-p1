<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaskFlow Pro - Workforce Management</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // API Configuration
        const API_URL = window.location.origin + '/api';

        // API Helper Functions
        const api = {
            async login(email, password) {
                const response = await fetch(`${API_URL}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });
                if (!response.ok) throw new Error('Login failed');
                return response.json();
            },

            async register(userData, token) {
                const response = await fetch(`${API_URL}/auth/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(userData)
                });
                if (!response.ok) throw new Error('Registration failed');
                return response.json();
            },

            async getUsers(token) {
                const response = await fetch(`${API_URL}/users`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                if (!response.ok) throw new Error('Failed to fetch users');
                return response.json();
            },

            async getWorkers(token) {
                const response = await fetch(`${API_URL}/users/workers`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                if (!response.ok) throw new Error('Failed to fetch workers');
                return response.json();
            },

            async getTasks(token, filters = {}) {
                const params = new URLSearchParams(filters);
                const response = await fetch(`${API_URL}/tasks?${params}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                if (!response.ok) throw new Error('Failed to fetch tasks');
                return response.json();
            },

            async createTask(token, taskData) {
                const response = await fetch(`${API_URL}/tasks`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(taskData)
                });
                if (!response.ok) throw new Error('Failed to create task');
                return response.json();
            },

            async updateTaskStatus(token, taskId, status) {
                const response = await fetch(`${API_URL}/tasks/${taskId}/status`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ status })
                });
                if (!response.ok) throw new Error('Failed to update task');
                return response.json();
            },

            async addError(token, taskId, description) {
                const response = await fetch(`${API_URL}/tasks/${taskId}/errors`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ description })
                });
                if (!response.ok) throw new Error('Failed to add error');
                return response.json();
            },

            async getStats(token, filters = {}) {
                const params = new URLSearchParams(filters);
                const response = await fetch(`${API_URL}/stats?${params}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                if (!response.ok) throw new Error('Failed to fetch stats');
                return response.json();
            }
        };

        // Icons (same as before)
        const Calendar = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>;
        const CheckCircle2 = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="12" cy="12" r="10"></circle><path d="m9 12 2 2 4-4"></path></svg>;
        const AlertCircle = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>;
        const Users = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M22 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>;
        const LinkIcon = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg>;
        const TrendingUp = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline><polyline points="17 6 23 6 23 12"></polyline></svg>;
        const Plus = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>;
        const Search = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>;
        const Clock = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>;
        const Award = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="12" cy="8" r="7"></circle><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"></polyline></svg>;
        const AlertTriangle = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>;
        const UserPlus = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><line x1="19" y1="8" x2="19" y2="14"></line><line x1="22" y1="11" x2="16" y2="11"></line></svg>;

        const TaskManager = () => {
            const [token, setToken] = useState(localStorage.getItem('token'));
            const [currentUser, setCurrentUser] = useState(null);
            const [currentView, setCurrentView] = useState('login');
            const [users, setUsers] = useState([]);
            const [tasks, setTasks] = useState([]);
            const [stats, setStats] = useState(null);
            const [loading, setLoading] = useState(false);

            // Filters
            const [searchTerm, setSearchTerm] = useState('');
            const [filterMonth, setFilterMonth] = useState('');
            const [filterYear, setFilterYear] = useState('');
            const [selectedWorker, setSelectedWorker] = useState('all');

            // Modals
            const [showTaskModal, setShowTaskModal] = useState(false);
            const [showErrorModal, setShowErrorModal] = useState(false);
            const [showRegisterModal, setShowRegisterModal] = useState(false);
            const [selectedTask, setSelectedTask] = useState(null);

            // Forms
            const [loginEmail, setLoginEmail] = useState('');
            const [loginPassword, setLoginPassword] = useState('');
            const [errorDescription, setErrorDescription] = useState('');
            const [newTask, setNewTask] = useState({
                title: '',
                link: '',
                assignedTo: '',
                description: ''
            });
            const [newUser, setNewUser] = useState({
                email: '',
                password: '',
                name: '',
                role: 'worker'
            });

            useEffect(() => {
                if (token) {
                    verifyToken();
                }
            }, [token]);

            useEffect(() => {
                if (currentUser) {
                    loadData();
                }
            }, [currentUser, searchTerm, selectedWorker, filterMonth, filterYear]);

            const verifyToken = async () => {
                try {
                    const userData = JSON.parse(atob(token.split('.')[1]));
                    setCurrentUser(userData);
                    setCurrentView(userData.role === 'admin' ? 'admin-dashboard' : 'worker-dashboard');
                } catch (error) {
                    handleLogout();
                }
            };

            const loadData = async () => {
                try {
                    setLoading(true);
                    
                    // Load users (for admin)
                    if (currentUser.role === 'admin') {
                        const usersData = await api.getWorkers(token);
                        setUsers(usersData);
                    }

                    // Load tasks
                    const filters = {
                        worker: selectedWorker,
                        month: filterMonth,
                        year: filterYear,
                        search: searchTerm
                    };
                    const tasksData = await api.getTasks(token, filters);
                    setTasks(tasksData);

                    // Load stats
                    const statsData = await api.getStats(token, filters);
                    setStats(statsData);
                } catch (error) {
                    console.error('Error loading data:', error);
                    if (error.message.includes('token')) {
                        handleLogout();
                    }
                } finally {
                    setLoading(false);
                }
            };

            const handleLogin = async () => {
                try {
                    setLoading(true);
                    const data = await api.login(loginEmail, loginPassword);
                    setToken(data.token);
                    localStorage.setItem('token', data.token);
                    setCurrentUser(data.user);
                    setCurrentView(data.user.role === 'admin' ? 'admin-dashboard' : 'worker-dashboard');
                } catch (error) {
                    alert('Invalid credentials');
                } finally {
                    setLoading(false);
                }
            };

            const handleLogout = () => {
                setToken(null);
                setCurrentUser(null);
                setCurrentView('login');
                localStorage.removeItem('token');
            };

            const handleCreateTask = async () => {
                if (!newTask.title || !newTask.link || !newTask.assignedTo) {
                    alert('Please fill in all required fields');
                    return;
                }

                try {
                    setLoading(true);
                    await api.createTask(token, newTask);
                    setShowTaskModal(false);
                    setNewTask({ title: '', link: '', assignedTo: '', description: '' });
                    loadData();
                } catch (error) {
                    alert('Failed to create task');
                } finally {
                    setLoading(false);
                }
            };

            const handleCompleteTask = async (taskId) => {
                try {
                    setLoading(true);
                    await api.updateTaskStatus(token, taskId, 'completed');
                    loadData();
                } catch (error) {
                    alert('Failed to complete task');
                } finally {
                    setLoading(false);
                }
            };

            const handleApproveTask = async (taskId) => {
                try {
                    setLoading(true);
                    await api.updateTaskStatus(token, taskId, 'approved');
                    loadData();
                } catch (error) {
                    alert('Failed to approve task');
                } finally {
                    setLoading(false);
                }
            };

            const handleAddError = async () => {
                if (!errorDescription) {
                    alert('Please enter error description');
                    return;
                }

                try {
                    setLoading(true);
                    await api.addError(token, selectedTask.id, errorDescription);
                    setShowErrorModal(false);
                    setErrorDescription('');
                    setSelectedTask(null);
                    loadData();
                } catch (error) {
                    alert('Failed to add error');
                } finally {
                    setLoading(false);
                }
            };

            const handleRegisterUser = async () => {
                if (!newUser.email || !newUser.password || !newUser.name) {
                    alert('Please fill in all fields');
                    return;
                }

                try {
                    setLoading(true);
                    await api.register(newUser, token);
                    setShowRegisterModal(false);
                    setNewUser({ email: '', password: '', name: '', role: 'worker' });
                    loadData();
                    alert('User created successfully');
                } catch (error) {
                    alert('Failed to create user');
                } finally {
                    setLoading(false);
                }
            };

            // Login View
            if (currentView === 'login') {
                return (
                    <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 p-4">
                        <div className="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxwYXRoIGQ9Ik0zNiAxOGMzLjMxNCAwIDYgMi42ODYgNiA2cy0yLjY4NiA2LTYgNi02LTIuNjg2LTYtNiAyLjY4Ni02IDYtNnoiIHN0cm9rZT0iIzRhNWI2YiIgc3Ryb2tlLXdpZHRoPSIuNSIgb3BhY2l0eT0iLjEiLz48L2c+PC9zdmc+')] opacity-20"></div>
                        
                        <div className="bg-white/10 backdrop-blur-xl p-12 rounded-3xl shadow-2xl border border-white/20 max-w-md w-full relative overflow-hidden">
                            <div className="absolute top-0 right-0 w-40 h-40 bg-purple-500/20 rounded-full blur-3xl"></div>
                            <div className="absolute bottom-0 left-0 w-40 h-40 bg-blue-500/20 rounded-full blur-3xl"></div>
                            
                            <div className="relative z-10">
                                <div className="flex items-center justify-center mb-8">
                                    <div className="bg-gradient-to-br from-purple-400 to-blue-500 p-4 rounded-2xl shadow-lg">
                                        <Users className="w-10 h-10 text-white" />
                                    </div>
                                </div>
                                
                                <h1 className="text-4xl font-bold text-white text-center mb-2 tracking-tight">TaskFlow Pro</h1>
                                <p className="text-purple-200 text-center mb-8 text-sm">Workforce Management System</p>
                                
                                <div className="space-y-5">
                                    <div>
                                        <label className="block text-purple-100 text-sm font-semibold mb-2">Email Address</label>
                                        <input
                                            type="email"
                                            value={loginEmail}
                                            onChange={(e) => setLoginEmail(e.target.value)}
                                            className="w-full px-4 py-3 bg-white/10 border border-white/30 rounded-xl text-white placeholder-purple-200/50 focus:outline-none focus:ring-2 focus:ring-purple-400 focus:border-transparent transition-all"
                                            placeholder="Enter your email"
                                        />
                                    </div>
                                    
                                    <div>
                                        <label className="block text-purple-100 text-sm font-semibold mb-2">Password</label>
                                        <input
                                            type="password"
                                            value={loginPassword}
                                            onChange={(e) => setLoginPassword(e.target.value)}
                                            onKeyPress={(e) => e.key === 'Enter' && handleLogin()}
                                            className="w-full px-4 py-3 bg-white/10 border border-white/30 rounded-xl text-white placeholder-purple-200/50 focus:outline-none focus:ring-2 focus:ring-purple-400 focus:border-transparent transition-all"
                                            placeholder="Enter your password"
                                        />
                                    </div>
                                    
                                    <button
                                        onClick={handleLogin}
                                        disabled={loading}
                                        className="w-full bg-gradient-to-r from-purple-500 to-blue-500 text-white py-3 rounded-xl font-semibold hover:from-purple-600 hover:to-blue-600 transition-all shadow-lg hover:shadow-xl transform hover:scale-[1.02] active:scale-[0.98] disabled:opacity-50"
                                    >
                                        {loading ? 'Signing in...' : 'Sign In'}
                                    </button>
                                </div>
                                
                                <div className="mt-8 pt-6 border-t border-white/20">
                                    <p className="text-purple-200/70 text-xs text-center">Demo Credentials:</p>
                                    <p className="text-purple-100 text-xs text-center mt-2">Admin: admin@example.com / admin123</p>
                                    <p className="text-purple-100 text-xs text-center">Worker: worker@example.com / worker123</p>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // Admin Dashboard (similar to before but with API calls)
            if (currentView === 'admin-dashboard') {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-slate-50 to-blue-50">
                        <div className="bg-white border-b border-slate-200 shadow-sm">
                            <div className="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
                                <div className="flex items-center space-x-3">
                                    <div className="bg-gradient-to-br from-purple-500 to-blue-500 p-2 rounded-lg">
                                        <Users className="w-6 h-6 text-white" />
                                    </div>
                                    <div>
                                        <h1 className="text-2xl font-bold text-slate-800">TaskFlow Pro</h1>
                                        <p className="text-sm text-slate-500">Admin Panel - {currentUser.email}</p>
                                    </div>
                                </div>
                                <div className="flex items-center space-x-3">
                                    <button
                                        onClick={() => setShowRegisterModal(true)}
                                        className="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-all flex items-center space-x-2"
                                    >
                                        <UserPlus className="w-5 h-5" />
                                        <span>Add User</span>
                                    </button>
                                    <button
                                        onClick={handleLogout}
                                        className="px-4 py-2 text-slate-600 hover:text-slate-800 hover:bg-slate-100 rounded-lg transition-all"
                                    >
                                        Sign Out
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div className="max-w-7xl mx-auto px-6 py-8">
                            {stats && (
                                <div className="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                                    <div className="bg-white rounded-2xl p-6 shadow-sm border border-slate-200">
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <p className="text-slate-500 text-sm font-medium mb-1">Total Tasks</p>
                                                <p className="text-3xl font-bold text-slate-800">{stats.total}</p>
                                            </div>
                                            <div className="bg-blue-100 p-3 rounded-xl">
                                                <TrendingUp className="w-6 h-6 text-blue-600" />
                                            </div>
                                        </div>
                                    </div>

                                    <div className="bg-white rounded-2xl p-6 shadow-sm border border-slate-200">
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <p className="text-slate-500 text-sm font-medium mb-1">Completed</p>
                                                <p className="text-3xl font-bold text-green-600">{stats.completed}</p>
                                            </div>
                                            <div className="bg-green-100 p-3 rounded-xl">
                                                <CheckCircle2 className="w-6 h-6 text-green-600" />
                                            </div>
                                        </div>
                                    </div>

                                    <div className="bg-white rounded-2xl p-6 shadow-sm border border-slate-200">
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <p className="text-slate-500 text-sm font-medium mb-1">Total Errors</p>
                                                <p className="text-3xl font-bold text-red-600">{stats.errors}</p>
                                            </div>
                                            <div className="bg-red-100 p-3 rounded-xl">
                                                <AlertTriangle className="w-6 h-6 text-red-600" />
                                            </div>
                                        </div>
                                    </div>

                                    <div className="bg-white rounded-2xl p-6 shadow-sm border border-slate-200">
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <p className="text-slate-500 text-sm font-medium mb-1">Success Rate</p>
                                                <p className="text-3xl font-bold text-purple-600">{stats.successRate}%</p>
                                            </div>
                                            <div className="bg-purple-100 p-3 rounded-xl">
                                                <Award className="w-6 h-6 text-purple-600" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}

                            <div className="bg-white rounded-2xl p-6 shadow-sm border border-slate-200 mb-6">
                                <div className="grid grid-cols-1 md:grid-cols-6 gap-4">
                                    <div className="md:col-span-2">
                                        <label className="block text-sm font-medium text-slate-700 mb-2">Search</label>
                                        <div className="relative">
                                            <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400" />
                                            <input
                                                type="text"
                                                value={searchTerm}
                                                onChange={(e) => setSearchTerm(e.target.value)}
                                                placeholder="Search tasks..."
                                                className="w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                            />
                                        </div>
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium text-slate-700 mb-2">Worker</label>
                                        <select
                                            value={selectedWorker}
                                            onChange={(e) => setSelectedWorker(e.target.value)}
                                            className="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                        >
                                            <option value="all">All Workers</option>
                                            {users.map(w => (
                                                <option key={w.id} value={w.id}>{w.name}</option>
                                            ))}
                                        </select>
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium text-slate-700 mb-2">Month</label>
                                        <select
                                            value={filterMonth}
                                            onChange={(e) => setFilterMonth(e.target.value)}
                                            className="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                        >
                                            <option value="">All Months</option>
                                            {['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'].map((m, i) => (
                                                <option key={i} value={i}>{m}</option>
                                            ))}
                                        </select>
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium text-slate-700 mb-2">Year</label>
                                        <select
                                            value={filterYear}
                                            onChange={(e) => setFilterYear(e.target.value)}
                                            className="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                        >
                                            <option value="">All Years</option>
                                            <option value="2024">2024</option>
                                            <option value="2025">2025</option>
                                            <option value="2026">2026</option>
                                        </select>
                                    </div>

                                    <div className="flex items-end">
                                        <button
                                            onClick={() => setShowTaskModal(true)}
                                            className="w-full bg-gradient-to-r from-purple-500 to-blue-500 text-white px-4 py-2 rounded-lg font-medium hover:from-purple-600 hover:to-blue-600 transition-all shadow-md hover:shadow-lg flex items-center justify-center space-x-2"
                                        >
                                            <Plus className="w-5 h-5" />
                                            <span>New Task</span>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div className="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                                <div className="overflow-x-auto">
                                    <table className="w-full">
                                        <thead className="bg-slate-50 border-b border-slate-200">
                                            <tr>
                                                <th className="px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider">Task</th>
                                                <th className="px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider">Worker</th>
                                                <th className="px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider">Status</th>
                                                <th className="px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider">Errors</th>
                                                <th className="px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider">Date</th>
                                                <th className="px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y divide-slate-200">
                                            {loading ? (
                                                <tr>
                                                    <td colSpan="6" className="px-6 py-12 text-center text-slate-500">
                                                        Loading...
                                                    </td>
                                                </tr>
                                            ) : tasks.length === 0 ? (
                                                <tr>
                                                    <td colSpan="6" className="px-6 py-12 text-center text-slate-500">
                                                        No tasks found. Create a new task to get started.
                                                    </td>
                                                </tr>
                                            ) : (
                                                tasks.map(task => {
                                                    const worker = users.find(u => u.id === task.assigned_to);
                                                    return (
                                                        <tr key={task.id} className="hover:bg-slate-50 transition-colors">
                                                            <td className="px-6 py-4">
                                                                <div>
                                                                    <p className="font-medium text-slate-800">{task.title}</p>
                                                                    <p className="text-sm text-slate-500 mt-1">{task.description}</p>
                                                                    <a href={task.link} target="_blank" rel="noopener noreferrer" className="text-sm text-blue-600 hover:text-blue-700 mt-1 inline-flex items-center space-x-1">
                                                                        <LinkIcon className="w-3 h-3" />
                                                                        <span>View Link</span>
                                                                    </a>
                                                                </div>
                                                            </td>
                                                            <td className="px-6 py-4">
                                                                <span className="text-slate-700 font-medium">{worker?.name}</span>
                                                            </td>
                                                            <td className="px-6 py-4">
                                                                {task.status === 'pending' && (
                                                                    <span className="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-700">
                                                                        <Clock className="w-3 h-3 mr-1" />
                                                                        Pending
                                                                    </span>
                                                                )}
                                                                {task.status === 'completed' && (
                                                                    <span className="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-700">
                                                                        <CheckCircle2 className="w-3 h-3 mr-1" />
                                                                        Completed
                                                                    </span>
                                                                )}
                                                                {task.status === 'approved' && (
                                                                    <span className="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-700">
                                                                        <CheckCircle2 className="w-3 h-3 mr-1" />
                                                                        Approved
                                                                    </span>
                                                                )}
                                                            </td>
                                                            <td className="px-6 py-4">
                                                                <span className={`font-semibold ${task.errors.length > 0 ? 'text-red-600' : 'text-slate-400'}`}>
                                                                    {task.errors.length}
                                                                </span>
                                                            </td>
                                                            <td className="px-6 py-4 text-sm text-slate-500">
                                                                {new Date(task.created_at).toLocaleDateString()}
                                                            </td>
                                                            <td className="px-6 py-4">
                                                                <div className="flex items-center space-x-2">
                                                                    {task.status === 'completed' && (
                                                                        <button
                                                                            onClick={() => handleApproveTask(task.id)}
                                                                            className="p-2 text-green-600 hover:bg-green-50 rounded-lg transition-colors"
                                                                            title="Approve Task"
                                                                        >
                                                                            <CheckCircle2 className="w-5 h-5" />
                                                                        </button>
                                                                    )}
                                                                    <button
                                                                        onClick={() => {
                                                                            setSelectedTask(task);
                                                                            setShowErrorModal(true);
                                                                        }}
                                                                        className="p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors"
                                                                        title="Report Error"
                                                                    >
                                                                        <AlertCircle className="w-5 h-5" />
                                                                    </button>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                    );
                                                })
                                            )}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        {/* Task Modal */}
                        {showTaskModal && (
                            <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50">
                                <div className="bg-white rounded-2xl p-8 max-w-md w-full shadow-2xl">
                                    <h2 className="text-2xl font-bold text-slate-800 mb-6">Create New Task</h2>
                                    
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-2">Task Title *</label>
                                            <input
                                                type="text"
                                                value={newTask.title}
                                                onChange={(e) => setNewTask({...newTask, title: e.target.value})}
                                                className="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                placeholder="Enter task title"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-2">Link *</label>
                                            <input
                                                type="url"
                                                value={newTask.link}
                                                onChange={(e) => setNewTask({...newTask, link: e.target.value})}
                                                className="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                placeholder="https://example.com"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-2">Description</label>
                                            <textarea
                                                value={newTask.description}
                                                onChange={(e) => setNewTask({...newTask, description: e.target.value})}
                                                className="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent h-24 resize-none"
                                                placeholder="Task description..."
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-2">Assign To *</label>
                                            <select
                                                value={newTask.assignedTo}
                                                onChange={(e) => setNewTask({...newTask, assignedTo: e.target.value})}
                                                className="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                            >
                                                <option value="">Select Worker</option>
                                                {users.map(w => (
                                                    <option key={w.id} value={w.id}>{w.name}</option>
                                                ))}
                                            </select>
                                        </div>
                                    </div>

                                    <div className="flex space-x-3 mt-6">
                                        <button
                                            onClick={() => setShowTaskModal(false)}
                                            className="flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 transition-all"
                                        >
                                            Cancel
                                        </button>
                                        <button
                                            onClick={handleCreateTask}
                                            disabled={loading}
                                            className="flex-1 px-4 py-2 bg-gradient-to-r from-purple-500 to-blue-500 text-white rounded-lg hover:from-purple-600 hover:to-blue-600 transition-all shadow-md disabled:opacity-50"
                                        >
                                            {loading ? 'Creating...' : 'Create Task'}
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Error Modal */}
                        {showErrorModal && selectedTask && (
                            <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50">
                                <div className="bg-white rounded-2xl p-8 max-w-md w-full shadow-2xl">
                                    <h2 className="text-2xl font-bold text-slate-800 mb-4">Report Error</h2>
                                    <p className="text-slate-600 mb-6">Task: {selectedTask.title}</p>
                                    
                                    <div className="mb-6">
                                        <label className="block text-sm font-medium text-slate-700 mb-2">Error Description</label>
                                        <textarea
                                            value={errorDescription}
                                            onChange={(e) => setErrorDescription(e.target.value)}
                                            className="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent h-32 resize-none"
                                            placeholder="Describe the error..."
                                        />
                                    </div>

                                    {selectedTask.errors && selectedTask.errors.length > 0 && (
                                        <div className="mb-6 bg-red-50 border border-red-200 rounded-lg p-4">
                                            <h3 className="text-sm font-semibold text-red-800 mb-2">Previous Errors ({selectedTask.errors.length})</h3>
                                            <div className="space-y-2 max-h-40 overflow-y-auto">
                                                {selectedTask.errors.map(err => (
                                                    <div key={err.id} className="text-xs text-red-700 bg-white p-2 rounded">
                                                        <p>{err.description}</p>
                                                        <p className="text-red-500 mt-1">{new Date(err.reported_at).toLocaleString()}</p>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    )}

                                    <div className="flex space-x-3">
                                        <button
                                            onClick={() => {
                                                setShowErrorModal(false);
                                                setErrorDescription('');
                                                setSelectedTask(null);
                                            }}
                                            className="flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 transition-all"
                                        >
                                            Cancel
                                        </button>
                                        <button
                                            onClick={handleAddError}
                                            disabled={loading}
                                            className="flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-all shadow-md disabled:opacity-50"
                                        >
                                            {loading ? 'Reporting...' : 'Report Error'}
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Register User Modal */}
                        {showRegisterModal && (
                            <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50">
                                <div className="bg-white rounded-2xl p-8 max-w-md w-full shadow-2xl">
                                    <h2 className="text-2xl font-bold text-slate-800 mb-6">Add New User</h2>
                                    
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-2">Name *</label>
                                            <input
                                                type="text"
                                                value={newUser.name}
                                                onChange={(e) => setNewUser({...newUser, name: e.target.value})}
                                                className="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                placeholder="Full name"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-2">Email *</label>
                                            <input
                                                type="email"
                                                value={newUser.email}
                                                onChange={(e) => setNewUser({...newUser, email: e.target.value})}
                                                className="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                placeholder="email@example.com"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-2">Password *</label>
                                            <input
                                                type="password"
                                                value={newUser.password}
                                                onChange={(e) => setNewUser({...newUser, password: e.target.value})}
                                                className="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                placeholder="Password"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-2">Role *</label>
                                            <select
                                                value={newUser.role}
                                                onChange={(e) => setNewUser({...newUser, role: e.target.value})}
                                                className="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                            >
                                                <option value="worker">Worker</option>
                                                <option value="admin">Admin</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div className="flex space-x-3 mt-6">
                                        <button
                                            onClick={() => setShowRegisterModal(false)}
                                            className="flex-1 px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 transition-all"
                                        >
                                            Cancel
                                        </button>
                                        <button
                                            onClick={handleRegisterUser}
                                            disabled={loading}
                                            className="flex-1 px-4 py-2 bg-gradient-to-r from-purple-500 to-blue-500 text-white rounded-lg hover:from-purple-600 hover:to-blue-600 transition-all shadow-md disabled:opacity-50"
                                        >
                                            {loading ? 'Creating...' : 'Create User'}
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                );
            }

            // Worker Dashboard (similar rendering with API calls)
            if (currentView === 'worker-dashboard') {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-slate-50 to-purple-50">
                        <div className="bg-white border-b border-slate-200 shadow-sm">
                            <div className="max-w-6xl mx-auto px-6 py-4 flex justify-between items-center">
                                <div className="flex items-center space-x-3">
                                    <div className="bg-gradient-to-br from-purple-500 to-blue-500 p-2 rounded-lg">
                                        <Users className="w-6 h-6 text-white" />
                                    </div>
                                    <div>
                                        <h1 className="text-2xl font-bold text-slate-800">TaskFlow Pro</h1>
                                        <p className="text-sm text-slate-500">Worker Panel - {currentUser.email}</p>
                                    </div>
                                </div>
                                <button
                                    onClick={handleLogout}
                                    className="px-4 py-2 text-slate-600 hover:text-slate-800 hover:bg-slate-100 rounded-lg transition-all"
                                >
                                    Sign Out
                                </button>
                            </div>
                        </div>

                        <div className="max-w-6xl mx-auto px-6 py-8">
                            {stats && (
                                <div className="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                                    <div className="bg-white rounded-2xl p-6 shadow-sm border border-slate-200">
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <p className="text-slate-500 text-sm font-medium mb-1">Total Tasks</p>
                                                <p className="text-3xl font-bold text-slate-800">{stats.total}</p>
                                            </div>
                                            <div className="bg-blue-100 p-3 rounded-xl">
                                                <TrendingUp className="w-6 h-6 text-blue-600" />
                                            </div>
                                        </div>
                                    </div>

                                    <div className="bg-white rounded-2xl p-6 shadow-sm border border-slate-200">
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <p className="text-slate-500 text-sm font-medium mb-1">Completed</p>
                                                <p className="text-3xl font-bold text-green-600">{stats.completed}</p>
                                            </div>
                                            <div className="bg-green-100 p-3 rounded-xl">
                                                <CheckCircle2 className="w-6 h-6 text-green-600" />
                                            </div>
                                        </div>
                                    </div>

                                    <div className="bg-white rounded-2xl p-6 shadow-sm border border-slate-200">
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <p className="text-slate-500 text-sm font-medium mb-1">Approved</p>
                                                <p className="text-3xl font-bold text-purple-600">{stats.approved}</p>
                                            </div>
                                            <div className="bg-purple-100 p-3 rounded-xl">
                                                <Award className="w-6 h-6 text-purple-600" />
                                            </div>
                                        </div>
                                    </div>

                                    <div className="bg-white rounded-2xl p-6 shadow-sm border border-slate-200">
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <p className="text-slate-500 text-sm font-medium mb-1">Errors</p>
                                                <p className="text-3xl font-bold text-red-600">{stats.errors}</p>
                                            </div>
                                            <div className="bg-red-100 p-3 rounded-xl">
                                                <AlertTriangle className="w-6 h-6 text-red-600" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}

                            <div className="space-y-4">
                                {loading ? (
                                    <div className="bg-white rounded-2xl p-12 shadow-sm border border-slate-200 text-center">
                                        <p className="text-slate-500 text-lg">Loading...</p>
                                    </div>
                                ) : tasks.length === 0 ? (
                                    <div className="bg-white rounded-2xl p-12 shadow-sm border border-slate-200 text-center">
                                        <Clock className="w-16 h-16 text-slate-300 mx-auto mb-4" />
                                        <p className="text-slate-500 text-lg">No tasks assigned yet</p>
                                        <p className="text-slate-400 text-sm mt-2">Check back later for new assignments</p>
                                    </div>
                                ) : (
                                    tasks.map(task => (
                                        <div key={task.id} className="bg-white rounded-2xl p-6 shadow-sm border border-slate-200 hover:shadow-md transition-all">
                                            <div className="flex justify-between items-start mb-4">
                                                <div className="flex-1">
                                                    <h3 className="text-xl font-bold text-slate-800 mb-2">{task.title}</h3>
                                                    <p className="text-slate-600 mb-3">{task.description}</p>
                                                    <a 
                                                        href={task.link} 
                                                        target="_blank" 
                                                        rel="noopener noreferrer"
                                                        className="inline-flex items-center space-x-2 text-blue-600 hover:text-blue-700 font-medium"
                                                    >
                                                        <LinkIcon className="w-4 h-4" />
                                                        <span>Open Task Link</span>
                                                    </a>
                                                </div>
                                                
                                                <div className="ml-4">
                                                    {task.status === 'pending' && (
                                                        <span className="inline-flex items-center px-4 py-2 rounded-full text-sm font-medium bg-yellow-100 text-yellow-700">
                                                            <Clock className="w-4 h-4 mr-2" />
                                                            Pending
                                                        </span>
                                                    )}
                                                    {task.status === 'completed' && (
                                                        <span className="inline-flex items-center px-4 py-2 rounded-full text-sm font-medium bg-blue-100 text-blue-700">
                                                            <CheckCircle2 className="w-4 h-4 mr-2" />
                                                            Awaiting Approval
                                                        </span>
                                                    )}
                                                    {task.status === 'approved' && (
                                                        <span className="inline-flex items-center px-4 py-2 rounded-full text-sm font-medium bg-green-100 text-green-700">
                                                            <CheckCircle2 className="w-4 h-4 mr-2" />
                                                            Approved
                                                        </span>
                                                    )}
                                                </div>
                                            </div>

                                            <div className="flex items-center justify-between pt-4 border-t border-slate-200">
                                                <div className="flex items-center space-x-4 text-sm text-slate-500">
                                                    <span className="flex items-center space-x-1">
                                                        <Calendar className="w-4 h-4" />
                                                        <span>{new Date(task.created_at).toLocaleDateString()}</span>
                                                    </span>
                                                    {task.errors && task.errors.length > 0 && (
                                                        <span className="flex items-center space-x-1 text-red-600 font-medium">
                                                            <AlertTriangle className="w-4 h-4" />
                                                            <span>{task.errors.length} Error{task.errors.length > 1 ? 's' : ''}</span>
                                                        </span>
                                                    )}
                                                </div>

                                                {task.status === 'pending' && (
                                                    <button
                                                        onClick={() => handleCompleteTask(task.id)}
                                                        disabled={loading}
                                                        className="px-6 py-2 bg-gradient-to-r from-green-500 to-emerald-500 text-white rounded-lg font-medium hover:from-green-600 hover:to-emerald-600 transition-all shadow-md hover:shadow-lg disabled:opacity-50"
                                                    >
                                                        Mark Complete
                                                    </button>
                                                )}

                                                {task.status === 'approved' && task.approved_at && (
                                                    <div className="text-right">
                                                        <p className="text-sm text-green-600 font-medium"> Approved</p>
                                                        <p className="text-xs text-slate-500">{new Date(task.approved_at).toLocaleDateString()}</p>
                                                    </div>
                                                )}
                                            </div>

                                            {task.errors && task.errors.length > 0 && (
                                                <div className="mt-4 bg-red-50 border border-red-200 rounded-lg p-4">
                                                    <h4 className="text-sm font-semibold text-red-800 mb-2">Reported Errors:</h4>
                                                    <div className="space-y-2">
                                                        {task.errors.map(err => (
                                                            <div key={err.id} className="bg-white p-3 rounded-lg border border-red-200">
                                                                <p className="text-sm text-red-700">{err.description}</p>
                                                                <p className="text-xs text-red-500 mt-1">{new Date(err.reported_at).toLocaleString()}</p>
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    ))
                                )}
                            </div>
                        </div>
                    </div>
                );
            }

            return null;
        };

        ReactDOM.render(<TaskManager />, document.getElementById('root'));
    </script>
</body>
</html>
